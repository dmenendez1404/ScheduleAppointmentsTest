language: node_js
node_js:
- "10"
cache: npm
jobs:
  include:
  - stage: test
    script:
    - cd app/
    - npm install
    - npm run test:coverage:ci
    cache:
      directories:
      - app/node_modules
  - stage: deploy
    script:
    - cd app/
    - npm install -g firebase-tools
    - npm run build
    - firebase use --token $FIREBASE_DEPLOY_KEY production
    - firebase deploy -m "Pipeline $CI_PIPELINE_ID, build $CI_BUILD_ID" --non-interactive --token $FIREBASE_DEPLOY_KEY

stages:
- name: test
  # require the type to be a PR
  if: type = pull_request
- name: deploy
  # require the type to be push to any branch
  if: type = push